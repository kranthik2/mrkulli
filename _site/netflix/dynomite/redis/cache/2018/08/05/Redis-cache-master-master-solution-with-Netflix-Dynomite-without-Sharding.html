<!DOCTYPE html>

<html>

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>
    Redis cache master-master solution with Netflix Dynomite without Sharding - Mrkulli
    
  </title>

  <meta name="description" content="This article discusses about how to run Dynomite as docker container and offers solution for Non-Sharding and multi master replication. Sharing lessons learn...">

  <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="/assets/vendor/bootstrap/css/bootstrap.min.css">

  <link rel="stylesheet" href="/assets/vendor/fontawesome-free/css/all.min.css">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/netflix/dynomite/redis/cache/2018/08/05/Redis-cache-master-master-solution-with-Netflix-Dynomite-without-Sharding.html">
  <link rel="alternate" type="application/rss+xml" title="Mrkulli" href="/feed.xml">

</head>


<body>

  <!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="/">Mrkulli</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu
      <i class="fa fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href="/">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/about">About</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/posts">Posts</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/contact">Contact</a>
        </li>
      </ul>
    </div>
  </div>
</nav>


  <!-- Page Header -->

<header class="masthead" style="background-image: url('/img/posts/dynomite.png')">
  
    <div class="overlay"></div>
    <div class="container">
      <div class="row">
        <!-- <div class="col-lg-8 col-md-10 mx-auto"> -->
          <div class="col-lg-8 col-md-10 mx-auto">
          <div class="post-heading">
            <h1>Redis cache master-master solution with Netflix Dynomite without Sharding</h1>
            
            <span class="meta">Posted by
              <a href="#">Mrkulli</a>
              on August 05, 2018 &middot; <span class="reading-time" title="Estimated read time">
  
   3 mins  read </span>

            </span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">

        <p> This article discusses about how to run Dynomite as docker container and offers solution for Non-Sharding and multi master replication. Sharing lessons learned while setting up multi master cache solution, so you do not hit the same pitfalls. Sharding is mainly for very large scale applications, with lots of data and adds additional programming and operational complexity to application. If your application uses couple of GB’s memory and bound by read/write performance, you do not need Sharding. </p>

<p>Dynomite is the great product that offers multi master cache solution. Dynomite cluster consists of multiple data centers. A datacenter is a group of racks and rack is a group of nodes. Each rack consists of the entire dataset, which is partitioned across multiple nodes in that rack. Each node in a rack has a unique token, which helps to identify which dataset it owns.</p>

<img class="img-fluid" src="/img/posts/dynomite-architecture.png" alt="select-source">
                      
<p>To make dynomite node contain all the data set you need to use the same token (example ‘0’) for all the nodes, So every node in the cluster will have the complete data set and make sure to use simple provider as seed provider. If you use “florida_provider”, each dynomite node will periodically reach out to a dynomite-manager (side car) rest service to obtain the cluster members, see membership protocols for how membership protocol works. You do not need to run docker with -g gossip flag (dynomite wiki document is not up to date). </p>

<p>
Below is the sample dynomite.yml file for 4-node cluster with two nodes in two data centers and single node in a rack to replicate total data set to ALL nodes : </p>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="na">dyn_o_mite</span><span class="pi">:</span>
  <span class="na">datacenter</span><span class="pi">:</span> <span class="s">dc1</span>
  <span class="na">rack</span><span class="pi">:</span> <span class="s">rack1</span>
  <span class="na">dyn_listen</span><span class="pi">:</span> <span class="s">0.0.0.0:8103</span>
  <span class="na">dyn_seed_provider</span><span class="pi">:</span> <span class="s">simple_provider</span>
  <span class="na">dyn_seeds</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">149.191.72.64:8103:dc1:rack2:0</span>
    <span class="pi">-</span> <span class="s">149.191.72.65:8103:dc2:rack1:0</span>
    <span class="pi">-</span> <span class="s">149.191.72.66:8103:dc2:rack2:0</span>
  <span class="na">listen</span><span class="pi">:</span> <span class="s">0.0.0.0:8102</span>
  <span class="na">servers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">127.0.0.1:22122:1</span>
  <span class="na">preconnect</span><span class="pi">:</span> <span class="no">false</span>
  <span class="na">server_retry_timeout</span><span class="pi">:</span> <span class="s">30000</span>
  <span class="na">timeout</span><span class="pi">:</span> <span class="s">10000</span>
  <span class="na">server_failure_limit</span><span class="pi">:</span> <span class="s">20</span>
  <span class="na">tokens</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0'</span>
  <span class="na">pem_key_file</span><span class="pi">:</span> <span class="s">/apps/dynomite/conf/dynomite.pem</span>
  <span class="na">data_store</span><span class="pi">:</span> <span class="s">0</span>
  <span class="na">stats_listen</span><span class="pi">:</span> <span class="s">0.0.0.0:22222</span>
  <span class="na">secure_server_option</span><span class="pi">:</span> <span class="s">none</span>
  <span class="na">read_consistency</span><span class="pi">:</span> <span class="s">DC_QUORUM</span>
  <span class="na">write_consistency</span><span class="pi">:</span> <span class="s">DC_QUORUM</span>
  </code></pre></figure>

<p>
Above configuration uses DC_QUORUM consistency, that means reads and writes are propagated synchronously to quorum number of nodes in the local data center and asynchronously to the rest. Consistency is runtime configurable and can be separately configurable for read and writes. Dynomite communicates with other nodes for replication through peer port, 8103 in this case, make sure port is open between nodes for communication.
</p>

<p>
Update conf/redis_single.yml with updated dynomite.yml or update the <a href="https://github.com/Netflix/dynomite/blob/dev/docker/scripts/startup.sh">statup script </a>  with updated dynomite.yml name. </p>

</p>
Git clone dynomite, docker build and run container. </p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">git clone <span class="nt">-b</span> dev https://github.com/Netflix/dynomite.git
<span class="nb">cd </span>dynomite/docker
docker build <span class="nt">-t</span> dynomite_poc <span class="nb">.</span>
docker run <span class="nt">-name</span> dynomite_poc_instance <span class="nt">-i</span> <span class="nt">-i</span> dynomite_poc</code></pre></figure>


        <hr>

        <div class="clearfix">

          
          <a class="btn btn-primary float-left" href="/docker/iptables/firewall/linux/2018/07/18/Docker-container-network-isolation-using-iptables.html" data-toggle="tooltip" data-placement="top" title="Docker container network isolation using iptables">&larr; Previous<span class="d-none d-md-inline">
              Post</span></a>
          
          
          <a class="btn btn-primary float-right" href="/java/maven/junit/2019/04/03/Parallel-Junit-Test-Execution.html" data-toggle="tooltip" data-placement="top" title="Parallel Junit Test Execution with Maven">Next<span class="d-none d-md-inline">
              Post</span> &rarr;</a>
          

        </div>

      </div>
    </div>
  </div>
  <div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://https-kranthikulli-com.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  <!-- Footer -->

<hr>

<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        <ul class="list-inline text-center">
          
          <li class="list-inline-item">
            <a href="mailto:kullik2@gmail.com">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="far fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          
          
          
          <li class="list-inline-item">
            <a href="https://github.com/kranthik2">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="copyright text-muted">Copyright &copy; Mrkulli 2019</p>
      </div>
    </div>
  </div>
</footer>


  <script src="/assets/vendor/jquery/jquery.min.js"></script>
<script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/assets/vendor/mrkulli-blog/js/clean-blog.min.js"></script>

<script src="/assets/scripts.js"></script>
<script async src="//pagead2.googlesyndication.com/
pagead/js/adsbygoogle.js"></script>
<script>
(adsbygoogle = window.adsbygoogle || []).push({
google_ad_client: "ca-pub-3067106561982864",
enable_page_level_ads: true
});
</script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-141222368-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-141222368-1');
</script>



</body>

</html>
