<!DOCTYPE html>

<html>

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>
    Hystrix How to implement fallback and circuit breaker - Mrkulli
    
  </title>

  <meta name="description" content="Demonstrates how to use Netflix Hystrix api’s for synchronous, asynchronous execution with fallback and circuit breaker in spring (boot) application. Hystrix...">

  <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="/assets/vendor/bootstrap/css/bootstrap.min.css">

  <link rel="stylesheet" href="/assets/vendor/fontawesome-free/css/all.min.css">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="/hystrix/circuitbreaker/resilincy/2017/12/04/Hystrix-How-to-implement-fallback-and-circuit-breaker.html">
  <link rel="alternate" type="application/rss+xml" title="Mrkulli" href="/feed.xml">

</head>


<body>

  <!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="/">Mrkulli</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu
      <i class="fa fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href="/">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/about">About</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/posts">Posts</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/contact">Contact</a>
        </li>
      </ul>
    </div>
  </div>
</nav>


  <!-- Page Header -->

<header class="masthead" style="background-image: url('/img/posts/hystrix.png')">
  
    <div class="overlay"></div>
    <div class="container">
      <div class="row">
        <!-- <div class="col-lg-8 col-md-10 mx-auto"> -->
          <div class="col-lg-8 col-md-10 mx-auto">
          <div class="post-heading">
            <h1>Hystrix How to implement fallback and circuit breaker</h1>
            
            <span class="meta">Posted by
              <a href="#">Mrkulli</a>
              on December 04, 2017 &middot; <span class="reading-time" title="Estimated read time">
  
   8 mins  read </span>

            </span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">

        <p> Demonstrates how to use Netflix Hystrix api’s for synchronous, asynchronous execution with fallback and circuit breaker in spring (boot) application. Hystrix-javancia annotations makes easy to use hystrix with spring framework. we need to start by creating spring boot application, use spring initializer to generate sample boot application. </p>
<p>
For maven open pom.xml and add hystrix dependencies</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.netflix.hystrix<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>hystrix-core<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.5.12<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.netflix.hystrix<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>hystrix-javanica<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.5.12<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span></code></pre></figure>

<p>For gradle add below dependencies to build.gradle </p>

<figure class="highlight"><pre><code class="language-properties" data-lang="properties"><span class="err">compile</span> <span class="py">group</span><span class="p">:</span> <span class="s">'com.netflix.hystrix', name: 'hystrix-core', version: '1.5.12'</span>
<span class="err">compile</span> <span class="py">group</span><span class="p">:</span> <span class="s">'com.netflix.hystrix', name: 'hystrix-javanica', version: '1.5.12'</span></code></pre></figure>

<h4 > HystrixCommand synchronous with fallback </h4>

<p>
To run method as synchronous hystrix command you need to annotate method with @HystrixCommand annotation and graceful degradation can be achieved by declaring name of fallback method. Below test class shows how to use hystrix commonds and intentionally throwing exception in execute method to test fallback. Fallback is enabled by default, see <a href="https://github.com/Netflix/Hystrix/wiki/Configuration">hystrix configuration </a>
for what properties does hystrix uses and how to configure and override.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">kulli</span><span class="o">.</span><span class="na">hystrix</span><span class="o">.</span><span class="na">poc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestSynchronous</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>

    <span class="nd">@HystrixCommand</span><span class="o">(</span><span class="n">groupKey</span> <span class="o">=</span> <span class="s">"testExecute"</span><span class="o">,</span> <span class="n">commandKey</span> <span class="o">=</span> <span class="s">"cmdExecute"</span><span class="o">,</span>
            <span class="n">fallbackMethod</span> <span class="o">=</span> <span class="s">"fallbackTest"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"hystrix poc testing"</span><span class="o">);</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"Throwing exception deliberately for synchronous testing"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@HystrixCommand</span><span class="o">(</span><span class="n">groupKey</span> <span class="o">=</span> <span class="s">"testExecute"</span><span class="o">,</span> <span class="n">commandKey</span> <span class="o">=</span> <span class="s">"cmdExecute"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fallbackTest</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Catching failures in fallbackTest method"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h4> HystrixCommand asynchronous with fallback </h4>

<p>To process Hystrix asynchronously you should return an instance of asynchronous result in your command method as in the example below: </p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">kulli</span><span class="o">.</span><span class="na">hystrix</span><span class="o">.</span><span class="na">poc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.concurrent.Future</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestAsynchronous</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>

    <span class="nd">@HystrixCommand</span><span class="o">(</span><span class="n">groupKey</span> <span class="o">=</span> <span class="s">"testExecuteAsync"</span><span class="o">,</span> <span class="n">commandKey</span> <span class="o">=</span> <span class="s">"cmdExecuteAsync"</span><span class="o">,</span> <span class="n">fallbackMethod</span> <span class="o">=</span> <span class="s">"fallbackAsyncTest"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Future</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">executeAsync</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">RuntimeException</span> <span class="o">{</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"hystrix async poc testing"</span><span class="o">);</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"Throwing exception deliberately for asynchronous testing"</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="nd">@HystrixCommand</span><span class="o">(</span><span class="n">groupKey</span> <span class="o">=</span> <span class="s">"testExecuteAsync"</span><span class="o">,</span> <span class="n">commandKey</span> <span class="o">=</span> <span class="s">"cmdExecuteAsync"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Future</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">fallbackAsyncTest</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">RuntimeException</span> <span class="o">{</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Catching failures in fallbackAsyncTest method "</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h4> HystrixCommand circuit breaker </h4>

<p> circuitBreaker.errorThresholdPercentage property sets the error percentage at or above which the circuit should trip open and start short-circuiting requests to fallback logic. In below example setting circuitBreaker.forceOpen to true to force short circuit and show how circuit breaker works. This property forces the circuit breaker into an open state in which it will reject all requests and forcing them to fallback method. In real time you should use circuitBreaker.errorThresholdPercentage to handle circuit breaker depends failures percentage. </p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">kulli</span><span class="o">.</span><span class="na">hystrix</span><span class="o">.</span><span class="na">poc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.netflix.hystrix.contrib.javanica.annotation.HystrixProperty</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestSynchronousCircuitBreaker</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>

    <span class="nd">@HystrixCommand</span><span class="o">(</span><span class="n">groupKey</span> <span class="o">=</span> <span class="s">"executeCircuitBreaker"</span><span class="o">,</span> <span class="n">commandKey</span> <span class="o">=</span> <span class="s">"cmdCircuitTripExecute"</span><span class="o">,</span>
            <span class="n">fallbackMethod</span> <span class="o">=</span> <span class="s">"fallbackCircuitOpen"</span><span class="o">,</span> <span class="n">commandProperties</span> <span class="o">=</span> <span class="o">{</span>
            <span class="nd">@HystrixProperty</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"circuitBreaker.forceOpen"</span><span class="o">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s">"true"</span><span class="o">)</span>
    <span class="o">})</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">executeCircuitBreaker</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"hystrix circuit breaker poc testing"</span><span class="o">);</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"Throwing exception deliberately for circuit breaker testing"</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fallbackCircuitOpen</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Catching failures in fallback circuit open method"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>Inject <b>HystrixCommandAspect</b> bean into boot application configuration to test hystrix command and run spring boot application mvn spring-boot:run or you can run a Spring Boot application from your IDE as a simple Java application.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">kulli</span><span class="o">.</span><span class="na">hystrix</span><span class="o">.</span><span class="na">poc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.netflix.hystrix.contrib.javanica.aop.aspectj.HystrixCommandAspect</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.SpringApplication</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.ConfigurableApplicationContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>

<span class="nd">@SpringBootApplication</span>
<span class="nd">@ComponentScan</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HystrixSamplePOCApplication</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">ConfigurableApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="n">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">HystrixSamplePOCApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
        <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">TestSynchronous</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">execute</span><span class="o">();</span>
        <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">TestAsynchronous</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">executeAsync</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">HystrixCommandAspect</span> <span class="nf">hystrixAspect</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">HystrixCommandAspect</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>


<figure class="highlight"><pre><code class="language-log" data-lang="log">2018-08-04 17:04:01.220 DEBUG 7268 --- [x-testExecute-1] com.kulli.hystrix.poc.TestSynchronous    : hystrix sync poc testing
2018-08-04 17:04:01.227 DEBUG 7268 --- [x-testExecute-2] com.kulli.hystrix.poc.TestSynchronous    : Catching failures in fallbackTest method
2018-08-04 17:04:01.240 DEBUG 7268 --- [tExecuteAsync-1] com.kulli.hystrix.poc.TestAsynchronous   : hystrix async poc testing
2018-08-04 17:04:01.242 DEBUG 7268 --- [tExecuteAsync-2] com.kulli.hystrix.poc.TestAsynchronous   : Catching failures in fallbackAsyncTest method 
2018-08-04 17:04:01.244 DEBUG 7268 --- [           main] c.k.h.poc.TestSynchronousCircuitBreaker  : Catching failures in fallback circuit open method</code></pre></figure>


        <hr>

        <div class="clearfix">

          
          
          <a class="btn btn-primary float-right" href="/docker/iptables/firewall/linux/2018/07/18/Docker-container-network-isolation-using-iptables.html" data-toggle="tooltip" data-placement="top" title="Docker container network isolation using iptables">Next<span class="d-none d-md-inline">
              Post</span> &rarr;</a>
          

        </div>

      </div>
    </div>
  </div>
  <div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://https-kranthikulli-com.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  <!-- Footer -->

<hr>

<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        <ul class="list-inline text-center">
          
          <li class="list-inline-item">
            <a href="mailto:kullik2@gmail.com">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="far fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          
          
          
          <li class="list-inline-item">
            <a href="https://github.com/kranthik2">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="copyright text-muted">Copyright &copy; Mrkulli 2019</p>
      </div>
    </div>
  </div>
</footer>


  <script src="/assets/vendor/jquery/jquery.min.js"></script>
<script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/assets/vendor/mrkulli-blog/js/clean-blog.min.js"></script>

<script src="/assets/scripts.js"></script>
<script async src="//pagead2.googlesyndication.com/
pagead/js/adsbygoogle.js"></script>
<script>
(adsbygoogle = window.adsbygoogle || []).push({
google_ad_client: "ca-pub-3067106561982864",
enable_page_level_ads: true
});
</script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-141222368-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-141222368-1');
</script>



</body>

</html>
